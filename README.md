# siderust-cpp

Modern, header-only C++17 wrapper for **siderust** — a high-precision astronomical computation library written in Rust.

`siderust-cpp` provides idiomatic C++ types (RAII, exceptions, value semantics) on top of the C FFI layer generated by `siderust-ffi` and `tempoch-ffi`.

## Features

| Module | What you get |
|--------|-------------|
| **Time** (`time.hpp`) | `JulianDate`, `MJD`, `UTC`, `Period` — value types with arithmetic and UTC round-trips |
| **Coordinates** (`coordinates.hpp`) | `SphericalDirection`, `CartesianPosition`, `Geodetic` — frame-aware transforms |
| **Bodies** (`bodies.hpp`) | `Star` (RAII, catalog + custom), `Planet` (8 planets), `ProperMotion`, `Orbit` |
| **Observatories** (`observatories.hpp`) | Named sites: Roque de los Muchachos, Paranal, Mauna Kea, La Silla |
| **Altitude** (`altitude.hpp`) | Sun / Moon / Star / ICRS altitude: instant, above/below threshold, crossings, culminations |
| **Ephemeris** (`ephemeris.hpp`) | VSOP87 Sun/Earth positions, ELP2000 Moon position |

## Quick Start

```cpp
#include <siderust/siderust.hpp>
#include <cstdio>

int main() {
    using namespace siderust;

    auto obs  = roque_de_los_muchachos();
    auto jd   = JulianDate::from_utc({2026, 7, 15, 22, 0, 0});
    auto mjd  = MJD::from_jd(jd);

    // Sun altitude
    double alt = sun::altitude_at(obs, mjd);
    std::printf("Sun altitude: %.4f rad\n", alt);

    // Star from catalog
    auto vega = Star::catalog("VEGA");
    double star_alt = star_altitude::altitude_at(vega, obs, mjd);
    std::printf("Vega altitude: %.4f rad\n", star_alt);

    // Night periods (astronomical twilight)
    auto nights = sun::below_threshold(obs, mjd, mjd + 1.0, -18.0);
    for (auto& p : nights)
        std::printf("Night: MJD %.4f – %.4f\n", p.start_mjd(), p.end_mjd());

    return 0;
}
```

## Building

```bash
# Clone with submodules
git clone --recurse-submodules <url>
cd siderust-cpp

# Build
mkdir build && cd build
cmake ..
cmake --build .

# Run example
./demo

# Run tests
ctest --output-on-failure
```

### Prerequisites

- C++17 compiler (GCC 8+, Clang 7+, MSVC 2019+)
- CMake 3.15+
- Rust toolchain (cargo) — Rust FFI libraries are built automatically
- Internet connection for Google Test (fetched automatically)

### Project Layout

```
siderust-cpp/
├── CMakeLists.txt
├── cmake/
│   └── siderust_cppConfig.cmake.in
├── include/siderust/
│   ├── siderust.hpp          ← umbrella header
│   ├── ffi_core.hpp          ← error handling, enums
│   ├── time.hpp              ← JulianDate, MJD, Period, UTC
│   ├── coordinates.hpp       ← SphericalDirection, CartesianPosition, Geodetic
│   ├── bodies.hpp            ← Star, Planet, ProperMotion
│   ├── observatories.hpp     ← named observatory locations
│   ├── altitude.hpp          ← sun/moon/star altitude API
│   └── ephemeris.hpp         ← VSOP87/ELP2000 positions
├── examples/demo.cpp
├── tests/
│   ├── main.cpp
│   ├── test_time.cpp
│   ├── test_observatories.cpp
│   ├── test_coordinates.cpp
│   ├── test_bodies.cpp
│   ├── test_altitude.cpp
│   └── test_ephemeris.cpp
├── siderust/                 ← git submodule
└── siderust-ffi/             ← git submodule (or sibling)
```

## Architecture

```
┌──────────────┐
│  C++ user    │   #include <siderust/siderust.hpp>
│  code        │
└──────┬───────┘
       │  header-only (inline)
┌──────▼───────┐
│ siderust-cpp │   C++17 types, RAII, exceptions
│ (headers)    │
└──────┬───────┘
       │  extern "C" calls
┌──────▼───────┐  ┌──────────────┐
│ siderust-ffi │──│ tempoch-ffi  │   C ABI (cbindgen-generated)
│ (.so/.dylib) │  │ (.so/.dylib) │
└──────┬───────┘  └──────┬───────┘
       │                 │
┌──────▼─────────────────▼──┐
│       siderust (Rust)     │
│  coordinates · altitude   │
│  bodies · ephemeris       │
│  tempoch · affn · qtty    │
└───────────────────────────┘
```

## License

Same license as siderust. See [LICENSE](LICENSE).
